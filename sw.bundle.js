(()=>{"use strict";const e=navigator.language;e.split("-")[0];class t{static voices=[];static groups=[];static log(e){const{level:t,msg:o}=this.getMessages(e);this.echo(t,o),this.sendGTag(t,o)}static echo(e,t){0}static getMessages(e){const t={level:"warn",msg:""};if(e.length){const[o,...s]=e;return t.level=console[o]?o:"log",t.msg=console[o]?s.length?1===s.length?s[0]:s:o:1===e.length?o:e,t}return t}static group(e){const[t,o,s]=e;this.groups.includes(t)?s||this.echo(`log group ${t} already exists!`):(this.groups.push(t),this.echo(o?"groupCollapsed":"group",t))}static groupEnd(e){e?(this.groups.map((e=>this.echo("groupEnd"))),this.groups=[]):(this.groups.pop(),this.echo("groupEnd"))}static sendGTag(o,n){const r=`${t.getVoice()?.voiceURI}, ${s.translate_lang}/${e}`;["error","warn"].includes(o)&&"function"==typeof gtag&&gtag("event","error"===o?"error":"warn",{event_category:`${n}`,event_label:`${r}`,value:"error"===o?1:0,non_interaction:!0})}static getVoice(e){return"undefined"!=typeof window?t.voices?.length?t.voices[void 0!==e?e:s.speech_voice]:(t.setVoices(),t.voices?.[s.speech_voice]):{voiceURI:"N/A"}}static setVoices(){return"undefined"!=typeof window&&(t.voices?.length||(t.voices=window?.speechSynthesis?.getVoices())),t}}const o=(...e)=>t.log(e);o.group=(...e)=>e=>e,o.groupEnd=e=>e=>e,t.setVoices();const s={enable:1,speech_voice:0,translate_lang:e.split("-")[0],rate:1.2,max_rate:1.4,volume:1,pitch:1,speaking_control:"voice",custom_translate_lang:{name:"",code:""},ui_lang:e.split("-")[0],voices_map:{}},n=async e=>await new Promise(((e,t)=>{chrome.storage.sync.get("options",(o=>{chrome.runtime.lastError?t(chrome.runtime.lastError):(Object.assign(s,o?.options),e(s))}))}));console.clear_storage=()=>{chrome.storage.sync.clear().then((e=>o("storage clear")))},console.show_storage=()=>{new Promise(((e,t)=>{chrome.storage.sync.get(null,(o=>{if(chrome.runtime.lastError)return t(chrome.runtime.lastError);e(o)}))})).then((e=>console.log(e)))},(async e=>{const t={};let s=0,r="";chrome.runtime.onInstalled.addListener((async e=>{"update"===e?.reason&&a()}));const a=()=>{};chrome.storage.onChanged.addListener((async function(e,t){"sync"===t&&(o("changes",e),await c())}));const c=async e=>{try{Object.assign(t,await n()),s=1}catch(e){o("error",`Storage Error: ${e} \n${e.stack}`)}};chrome.runtime.onMessageExternal.addListener((function(e,o,n){var a;if(e?.hasOwnProperty("badge")&&(a={text:e.badge},a?.text&&chrome.action.setBadgeText((e=>(["On","Off"].includes(e.text)&&chrome.action.setBadgeBackgroundColor({color:[0,0,0,+!("On"===e.text)]}),e))(a))).then(),e?.hasOwnProperty("title")&&(r=e.title),(e?.hasOwnProperty("options")||s)&&(s=0,n({options:t})),e?.hasOwnProperty("update")){for(const[o,s]of Object.entries(e.update))t.hasOwnProperty(o)&&(t[o]=s);chrome.storage.sync.set({options:t},(async e=>{await c()}))}})),chrome.runtime.onMessage.addListener((function(e,t,o){"now_playing"===e.question&&o({answer:"now_playing",msg:r})})),await c()})()})();